`동시성`은 둘 이상의 코드 조각이 실행될 때 동시에 실행 중인 것처럼 행동하는 것이다.

`병렬성`이란 실제로 동시에 실행되는 것이다.

동시성을 얻으려면 실행 중에 코드의 다른 부분으로 실행을 전환할 수 있는 환경에서 코드를 구동해야 한다.

- 파이버
- 스래드
- 프로세스 등

병렬성을 얻으려면 두 가지 일을 동시에 할 수 있는 하드웨어가 필요하다.

## 모든 일에 동시성이 있다

`시간적 결합`은 당면한 문제 해결에 꼭 필요하지 않은 일 처리 순서를 코드가 강제할 때 생긴다.

동시성이나 병렬성을 지원하는 코드를 사용하기 어려운 이유는 우리가 프로그래밍을 순차적 시스템으로 배워서다.

# Topic 33 시간적 결합 깨트리기

시간에는 우리가 신경 써야 할 측면이 두 가지 있는데, 동시성(동시에 일어나는 일들)과 순서(시간의 흐름 속에서 일들의 상대적인 위치)다.

우리는 동시성을 확보해야 한다. 시간이나 순서에 의존하는 시간적 결합을 끊는 방법을 생각해 내야 한다. 그렇게 함으로써 유연성도 얻을 수 있고, 작업 흐름 분석과 아키텍처, 설계 배포와 같은 개발의 여러 측면에서 시간과 관련된 의존성도 함께 줄일 수 있다. 결과적으로 분석하기 더 쉽고 응답속도도 더 빠르며 더 안정적인 시스템을 만들 수 있을 것이다.

## 동시성 찾기

우리는 동시에 일어나도 되는 게 뭐고, 반드시 순서대로 일어나야 하는 건 어떤 것인지 찾아내길 원한다.

`Tip 56` 작업 흐름 분석으로 동시성을 개선하라.

## 동시 작업의 기회

우리는 시간이 걸리지만, 우리 코드가 아닌 곳에서 시간이 걸리는 활동을 찾고 싶다.

- 데이터페이스 조회
- 외부 서비스에 접근
- 사용자 입력

이런 순간이 바로 CPU가 손가락만 빨면서 기다리는 대신 좀 더 생산적인 일을 할 수 있는 기회다.

## 병렬 작업의 기회

동시성은 소프트웨어 동작 방식이고, 병렬성은 하드웨어가 가는 것이다.

일반적인 형태는 커다란 작업을 독립적인 부분들로 쪼개서 병렬로 각각 처리한 다음, 결과를 합치는 것이다.

## 기회를 찾아내는 것은 쉽다

# Topic 34 공유 상태는 틀린 상태

`Tip 57` 공유 상태는 틀린 상태다.

문제는 상태가 공유된 것이다.

## 비-원자적 갱신

갱신하는 동작이 원자적이지 않기 때문에 실제 값이 그사이에 바뀔 수 있다.

### 세마포어 및 다른 상호 배제 방법

세마포어는 단순히 한 번에 한 사람만이 가질 수 있는 무언가다.

### 리소스를 트랜잭션으로 관리하라

제어를 중앙으로 집중시켜라.

## 여러 리소스와 트랜잭션

## 트랜잭션이 없는 갱신

수정 가능한 리소스를 공유하는 애플리케이션 코드는 어디에서나 동시성 문제가 발생할 수 있다.

`Tip 58` 불규칙한 실패는 동시성 문제인 경우가 많다.

## 그 밖의 독점적인 접근

상호 배제를 의미하는 뮤텍스라고 부르기도 하고, 모니터나 세마포어라고 부르기도 한다.

러스트는 데이터의 소유권이라는 개념을 강제한다.

## 의사 선생님, 아파요…

리소스를 공유하는 환경에서 동시성은 어렵다.

# Topic 35 액터와 프로세스

- 액터는 자신만의 비공개 지역 상태를 가진 독립적인 가상 처리 장치다.
  - 우편함을 하나씩 보유
  - 우편함에 메시지가 도착하면 깨어남
  - 깨어나서 메시지 처리
  - 우편함이 비면 잠듦

## 액터는 언제나 동시성을 띤다.

- 액터를 관리하는 것이 하나도 없다.
- 시스템이 저장하는 상태는 오직 메시지 그리고 각 액터의 지역 상태뿐이다.
- 모든 메시지는 일방향이다. 답장이란 개념은 없다.
- 액터는 각 메시지를 끝날 때까지 처리하고 중간에 다른 일을 하지 않는다.

`Tip 59` 공유 상태 없는 동시성을 위하여 액터를 사용하라.

## 간단한 액터

## 드러나지 않는 동시성

액터 모델에서는 동시성을 다루는 코드를 쓸 필요가 없다. 공유된 상태가 없기 때문이다.

## 얼랭이 장을 마련하다.

동시에 실행되는 작업을 구현할 때 액터를 사용하라.

# Topic 36 칠판

일종의 자유방임주의적 동시성이다. 각 형사는 독립된 프로세스, 에이전트, 액터 등과 같다. 누군가는 칠판에 수집한 사실을 붙이고, 누군가는 떼어낸다.

## 칠판 사용 사례

데이터의 도착 순서는 이제 상관없다. 어떤 사실이 칠판에 올라가면 적절한 규칙이 발동되도록 하면 된다. 결과에 대한 피드백도 마찬가지로 쉽게 다룰 수 있다. 어떤 규칙에서 나온 것이든 그 결과를 다시 칠판에 올려서 다른 규칙들이 발동되도록 하면 된다.

`Tip 60` 칠판으로 작업 흐름을 조율하라

## 메시지 시스템과 칠판의 유사성

## 하지만 그렇게 간단하지 않다…

이런 접근 방식을 사용하면 많은 동작이 간접적으로 일어나므로 분석이 더 힘들다. 처리를 시작할 때 고유한 추적 아이디를 만들어서 붙이는 것이다.
