## 9장 단위 테스트

```
논의주제)
영원한 핑계거리 단위 테스트인데
작성을 못하는 이유에 대한 실질적이면서 근본적인 이유에 대해 이야기해 보기.

혹은(!?)
단위 테스트를 잘 작성해서 어떤 좋은점을 느꼈는지에 대해 이야기해 보기

---

작성 못하는 근본적인 이유는 실제 코드 변경에 대해 테스트 코드 변경이 귀찮은 점이 있다.
하지만 그 부분을 인지하고 서로 테스트 코드를 작성해야 한다고 다독여주는 팀에 속한다면 크게 문제가 된다고 보지 않는다.

단위 테스트 작성한 후 좋은 점은 확실히 변경에 대한 안정감이다.
코드 변경 이후 어김없이 테스트 코드가 실패하는 경우가 많으므로
테스트 코드를 다시 작성하면서 올바른 변경이었나를 다시 한번 더 생각하게 되고
그렇게 쌓인 테스트 코드는 좋은 품질의 소프트웨어를 만들고 있다는 확신도 주게 된다.

```

애자일과 TDD 덕택에 단위 테스트를 자동화하는 프로그래머들이 많아졌다.
그 와중에 제대로 된 테스트 케이스를 작성해야 한다는 좀 더 미묘한 사실을 놓치고 있다.

### TDD 법칙 세 가지

- 실패하는 단위 테스트를 작성할 떄까지 실제 코드를 작성하지 않는다
- 컴파일은 실패하지 않으면서 실행히 실패하는 정도로만 단위 테스트를 작성한다.
- 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.

이렇게 하면 테스트 케이스가 많아지는데
실제 코드와 맞먹을 정도로 방대한 테스트 코드는 심각한 관리 문제를 유발하기도 한다.

### 깨끗한 테스트 코드 유지하기

테스트 코드가 지저분해지면 실제 코드를 변경하기가 어려워진다.
그러다 보면 실제 코드를 짜는 시간보다 테스트 케이스를 추가하는 시간이 더 걸린다.

새 버전을 출시할 때 마다 테스트 케이스를 유지하고 보수하는 비용이 늘어난다.
테스트 코드는 개발자들 사이에서 불만으로 자리잡고 결국 폐기하는 상황에 놓인다.

테스트 코드가 없으면 수정한 코드가 안전하다는 검증을 하지 못한다.
그러면 결함율이 높아지고, 결함이 많아지면 개발자는 코드 변경을 주저한다. 그리고 코드가 망가지기 시작한다.

테스트 코드는 실제 코드 못지 않게 중요하다.
테스트 코드는 사고와 설계와 주의가 필요하다.
실제 코드 못지 않게 깨끗하게 짜야 한다.

#### 테스트는 유연성, 유지보수성, 재사용성을 제공한다

유연성, 유지보수성, 재사용성을 제공하는 버팀목은 단위 테스트다.
테스트 케이스가 있으면 변경이 두렵지 않게 된다.

실제 코드를 점검하는 자동화된 단위 테스트 슈트는 설계와 아키텍처를 최대한 깨끗하게 보존하는 열쇠다.

### 깨끗한 테스트 코드

꺠끗한 테스트 코드는 가독성이 중요하다.
가독성은 실제 코드보다 테스트 코드에 더더욱 중요하다.

테스트 코드는 본론에 돌입해 진짜 필요한 자료 유형과 함수만 사용한다.
그러므로 코드를 읽는 사람은 코드가 수행하는 기능을 재빨리 이해한다.

#### 도메인에 특화된 테스트 언어

API 위에다 함수와 유틸리티를 구현한 후 그 함수와 유틸리티를 사용하는 방식

#### 이중 표준

실제 환경과 테스트 환경은 요구사항이 다르다.
실제 환경에서는 절대로 안 되지만 테스트 환경에서는 전혀 문제없는 방식이 있다.

### 테스트당 assert 하나

단일 assert 문이라는 규칙은 적합하나 때로는 여러개의 assert 문을 넣을 때도 있다.
단지 assert 문 개수는 최대한 줄이는게 좋다.

#### 테스트당 개념 하나

테스트 함수마다 한 개념만 테스트하기

assert 문이 여러개라는 사실 보다는
한 테스트 함수에서 여러 개념을 테스트한다는 사실이 더 문제다.

그래서 assert 문 규칙과 조합하면
"개념 당 assert 문 수를 최소로 줄여라", "테스트 함수 하나는 개념 하나만 테스트 하라"
가 가장 좋은 규칙이다.

### F.I.R.S.T

- Fast: 테스트는 빨라야 한다. 느리면 자주 돌리지 못하고 그렇게 되면 문제를 찾아 고치기 어려워진다.
- Independent: 각 테스트는 서로 의존하면 안 된다.
- Repeatable: 테스트는 어떤 환경에서도 반복 가능해야 한다.
- Self-Validating: 테스트는 성공 아니면 실패로 결과를 내야 한다.
- Timely(적시에): 실제 코드를 구현하기 직전에 구현한다.

### 결론

테스트 코드가 방치되어 망가지면 실제 코드도 망가진다.
테스트 코드를 깨끗하게 유지하자.