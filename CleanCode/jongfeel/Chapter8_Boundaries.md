## 8장 경계

```
논의내용)
테스트 코드를 짜야 하는 건 다들 알지만 짜지 못하거나 안하는 건 둘째치고
외부 패키지에 대한 테스트 케이스를 작성하는 경계를 설명하는 부분은 흥미로운 것 같다.

외부 패키지에 대한 의존성으로 힘들었던 사례나
아니면 외부 패키지에 대한 경계를 잘 나눠서 코드를 분리했던 사례가 있으면 얘기해 보면 좋을 것 같다.

사실 나는 그런 생각을 잘 안하고 가져다 쓰는데만 많은 노력을 기울였던 것 같다.
이제 이 내용을 알았으니 외부 패키지의 경계 테스트 케이스를 만들어 보면 좋겠다는 생각이 든다. 
```

시스템에 들어가는 모든 소프트웨어를 직접 개발하는 경우는 드물다.
패키지를 사고, 오픈소스를 이용하고, 사내 팀이 제공하는 컴포넌트를 사용한다.
어떤 식으로든 외부 코드를 우리 코드에 깔끔하게 통합해야만 한다.

### 외부 코드 사용하기

인터페이스 제공자와 사용자 사이에는 특유의 긴장이 존재한다.
제공자는 적용성을 최대한 넓히려 하고 많은 환경에서 돌아가게 만들고 싶어한다.
사용자는 자신의 요구에 집중하는 인터페이스를 원한다.
이런 긴장으로 시스템 경계에서 문제가 생길 소지가 많다.

Map이 반환하는 Object를 올바른 유형으로 변환할 책임은 Map을 사용하는 클라이언트에 있다,

``` java
Map sensors = new HashMap();
Sensor s = (Sensor)sensors.get(sensorId);
```

Generics를 사용하면 코드 가독성이 크게 높아진다.
하지만 이 방법도 사용자에게 필요하지 않은 Map의 많은 기능을 제공한다는 문제는 해결하지 못한다.

``` java
Map<String, Sensor> sensors = new HashMap<Sensor>();
Sensor s = sensors.get(sensorId);
```

사용자는 generics를 사용했는지 여부에 신경 쓸 필요가 없다.

``` java
public class Sensors {
  private Map sensors = new HashMap();

  public Sensor getById(String id) {
    return (sensor) sensors.get(id);
  }
}
```

Map 인터페이스가 변경 되도 나머지 프로그램에 영향을 미치지 않는다.
또 Sensors 클래스는 프로그램에 필요한 인터페이스만 제공한다.

이렇게 캡슐화를 해야 한다는 게 중요한 것이 아니라
Map 과 같은 경계 인터페이스를 여기 저기서 사용하지 않게 하는 게 중요하다.

```
의견)
객체지향의 궁극의 경지는 상속이 아니라 합성(composition)이라는 걸 다시 생각하게 해주는 설명인 것 같다.
물론 합성을 사용하면서 얻고 잃게 되는 트레이드오프는 감안해야 하지만.
```

### 경계 살피고 익히기

외부 코드를 익히고 통합하기는 어렵다.
간단한 테스트 케이스를 통해 외부 코드를 익히는 학습 테스트를 거치면 좋다.

학습 테스트는 통제된 환경에서 API를 제대로 이해하는지 확인하는 방식이다.

### log4j 익히기

logger 사용 방법을 익히는 건 어렵지만 LogTest 클래스를 통해 테스트하고 경계를 파악한 후라면
독자적인 로거 클래스로 캡슐화해서 사용한다.
이후 프로그램은 log4j의 경계 인터페이스를 몰라도 된다.

### 학습 테스트는 공짜 이상이다

학습 테스트는 패키지의 새 버전이 나올 때 마다 변경되는 인터페이스에 대한 위험을 감지하고 호환성 체크를 해준다.
어쨌든 패키지의 인터페이스를 사용하는 테스트 케이스는 필요하므로,
예전 버전을 유지하려는 유혹을 뿌리치고 새 버전으로 이전하기 쉬워진다.

### 아직 존재하지 않는 코드를 사용하기

송신기 시스템 구축 예제
송신기 프로그램의 인터페이스도 정의가 안된 상태에서 진행
경게 인터페이스를 테스트 하는 클래스를 만들고 구현.

### 깨끗한 경계

소프트웨어 설계가 우수하다면 변경하는데 많은 투자와 재작업이 필요하지 않다.
엄청난 시간과 노력과 재작업을 요구하지 않는다.

```
의견)
위 두 줄에서 로버트 마틴의 그간의 경험을 함축적으로 이해할 수 있다.
변경이 쉬운 설계까지는 경험이 없더라도
우리 대부분은 변경이 어려운 재작업과 노력과 시간을 많이 들였던 기억이 있지 않은가??
우리는 항상 좋은 설계를 위한 끊임 없는 노력을 계속해야만 한다. 나중에 투자할 노력과 시간을 위해서라도!
```

경계에 위치하는 코드는 깔끔히 분리한다.
기대치를 정의하는 테스트 케이스도 작성한다.
외부 패키지 코드에 의존하는 것 보다는 우리가 작성한 테스트 케이스에 기반한 통제와 의존성을 높여야 한다.