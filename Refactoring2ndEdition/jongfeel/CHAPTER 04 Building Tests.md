## Chapter 04 Building Tests

리팩터링을 제대로 하려면 견고한 테스트 스위트(test suite)가 뒷받침돼야 한다.
리팩터링을 하지 않더라도 좋은 테스트를 작성하는 일은 개발 효율을 높여준다.

### Discussions

의외로 리팩터링의 단짝으로 단위 테스트를 챕터 하나를 할당해서 언급하고 있습니다.

이 챕터에서
(분명히 읽었었는데 기억이 안나는 걸 봐서는 읽기만 했던 것 같네요 ㅋㅋㅋ)
일부러 실패하는 케이스를 주입해서 실패를 확인하고 다시 성공하는 케이스로 되돌린다는 내용이 반복해서 나오는데
실제로 실천해 보면 좋겠다는 생각이 들었습니다.

왜냐하면 테스트가 꽃길(happy path)만 걷는 상황만 만들고,
이게 진짜 실패할 수도 있나? 라는 의심을 잘 안해봤다는 점에서 그렇습니다.

또 픽스처를 미리 테스트 마다 준비해서 진행한다는 것도 테스트 기법에 나와 있는데
실제 테스트 코드를 작성할 때는 그런 생각을 미처 못하는 것도 있는 것 같아요.

어쨌든 리팩토링을 위한 테스트 코드의 작성이라는 부분에서는 다들 공감하실 것 같아서
각자 생각했던 테스트 코드에 대한 다른 생각들이 생겼다면 얘기해 보면 좋겠습니다.

### THE VALUE OF SELF-TESTING CODE

버그를 찾고 수정하는데 걸리는 시간이 많다
그래서 클래스 마다 자가 테스트 코드를 만들면 좋다

> 모든 테스트를 완전히 자동화하고 그 결과까지 스스로 검사하게 만들자

테스트를 자주 수행하는 습관도 버그를 찾는 강력한 도구가 된다

> 테스트 스위트는 강력한 버그 검출 도구로, 버그를 찾는데 걸리는 시간을 대폭 줄여준다.

테스트를 작성하기 가장 좋은 시점은 프로그래밍을 시작하기 전이다. TDD

### SAMPLE CODE TO TEST

생산자(Producer) 클래스
지역(Province) 클래스

### A FIRST TEST

Mocha를 사용한 테스트 예제

> 실패해야 할 상황에서는 반드시 실패하게 만들자

테스트 코드에 오류를 넣어 실패하는 테스트이니 확인

> 자주 테스트하라. 작성 중인 코드는 최소한 몇 분 간격으로 테스트하고, 적어도 하루에 한 번은 전체 테스트를 돌려보자

어서션 라이브러리를 통해 assert나 expect를 사용하여 검증

### ADD ANOTHER TEST

테스트는 위험 요인을 중심으로 작성한다. 목적은 현재 혹은 향후 발생하는 버그를 찾는 데 있다.

> 완벽하게 만드느라 테스트를 수행 못하느니, 불완전한 테스트라도 작성해 실행하는게 낫다.

임시 값을 설정했다가 실제 값으로 대체하고, 오류를 심었다가 되돌리는 패턴으로 테스트 진행

테스트 코드에도 중복이 발생하기 때문에 중복 제거는 필수,
하지만 테스트끼리 상호작용하는 공유 픽스처는 테스트의 순서에 의해 결과가 달라질 수 있다.

beforeEach구문을 통해 매 테스트가 실행될때 마다 바로 전에 실행해서 초기화가 가능해진다.

### MODIFYING THE FIXTURE

Setter를 통해 픽스처를 수정하고 테스트 진행

- beforeEach 블록에서 설정한 표준 픽스처를 취해서
- 테스트를 수행하고
- 이 픽스처가 일을 기대한대로 처리했는지 검증한다

이 패턴은

- 설정-실행-검증, setup-exercise-verify
- 조건-발생-결과, given-when-then
- 준비-수행-단언, arrange-act-assert

으로 불린다.

### PROBING THE BOUNDARIES

범위를 벗어나는 경계지점 테스트를 통해 특이 상황을 어떻게 처리할지 생각해 볼 수 있다.

> 문제가 생길 가능성이 있는 경계 조건을 생각해보고 그 부분을 집중적으로 테스트하자

실패와 에러를 구분하는 코드 작성을 통해 조금 더 에러 상황을 잘 처리하는 코드를 작성할 수 있다.

> 어차피 모든 버그를 잡아낼 수는 없다고 생각하여 테스트를 작성하지 않는다면 대다수의 버그를  잡을 수 있는 기회를 날리는 셈이다.

위험한 부분에 집중해서 테스트 코드를 작성한다. 테스트가 모든 버그를 걸러주지는 못해도 안심하고 리팩터링할 수 있는 보호막은 되어준다.

### MUCH MORE THAN THIS

뛰어난 소프트웨어 개발자라면 테스트가 최우선 관심 주제로 떠오르고 있다. 테스트 용이성(testability)을 아키텍처 평가 기준으로 활용하는 사례도 많다.

단위 테스트는 코드의 작은 영역만을 대상으로 빠르게 실행되도록 설계된 테스트다.
단위 테스트느느 자가 테스트 코드의 핵심이자, 자가 테스트 시스템은 대부분 단위 테스트가 차지한다.

테스트도 반복적으로 진행하고, 한 번에 완벽한 테스트를 갖출 수 없으므로
기능을 새로 추가할 때 마다 테스트도 추가하는 것은 물론, 기존 테스트도 다시 살펴본다.
버그를 발견하는 즉시 발견한 버그를 명확히 잡아내는 테스트부터 작성하는 습관을 들이자

> 버그 리포트를 받으면 가장 먼저 그 버그를 드러내는 단위 테스트부터 작성하자.

테스트 커버리지 분석은 코드에서 테스트하지 않은 영역을 찾는 데만 도움될 뿐,
테스트 스위트의 품질과는 크게 상관 없다.

리팩터링 후 테스트 결과가 모두 초록색인 것만 보고도
리팩터링 과정에서 생겨난 버그가 하나도 없다고 확신할 수 있다면
충분히 좋은 테스트 스위트이다.

테스트 때문에 개발 속도가 느려진다고 생각되면 테스트를 과하게 작성한건 아닌지 의심해보자.