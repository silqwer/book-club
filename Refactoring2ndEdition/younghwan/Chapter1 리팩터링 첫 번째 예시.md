## CHAPTER 01 리팩터링: 첫 번째 예시

### 토론

> The Boy Scout Rule : "Always leave the campground cleaner than you found it.”

여러분들은 코드를 푸시할 때 풀 받기 전보다 깨끗하게 하시나요??

저는 노력을 하긴 하는데, 다른 사람이 만든 코드는 고칠 수 있더라도 잘 안고치게 되는 것 같습니다. 

### 1.1 자, 시작해보자

공연 요청이 들어오면 연극의 장르와 관객 규모로 비용을 책정하는 프로그램

```jsx
for performances
  switch
  case 장르:
    기본 가격;
    관객수가 n명 이상이면 추가 금액 발생
  ...
  
  포인트 적립
  if 희극
    포인트 적립 추가
  청구내역 및 포인트 출력
```

### 1.2 예시 프로그램을 본 소감

‘지저분 하긴 한데’ 그럭저럭 쓸만하다

- 프로그램이 새로운 기능을 추구하기에 편한 구조가 아니라면, 먼저 기능을 추가하기 쉬운 형태로 리팩터링하고 나서 원하는 기능을 추가한다

청구 내역을 HTML로 출력한다면?

연극 장르와 공연료 정책이 달라진다면?

리팩터링이 필요한 이유는 이러한 변경 때문이다.

→ 다른 사람이 짠 코드가 길고 지저분하여 어디부터 수정해야 될 지 혼란스러웠던 적이 있었습니다. 다음에 이런 상황이 생긴다면 기존 코드를 여러 함수로 재구성 하는 것 부터 시작해야겠습니다.

### 1.3 리팩터링의 첫 단계

- 테스트부터 마련하라

→ 당연한 내용인데 지켜지지 않고 있었네요. 리팩터링을 하기 전에 테스트 코드부터 점검해야되겠습니다.

### 1.4 statement() 함수 쪼개기

- 함수 추출하기
- 명확한 변수명으로 변경하기

매개변수 이름에 부정 관사(a/an) 붙이는 예시

→ a나 an을 왜 붙이는지, 붙였을 때의 이점이 무엇인지 잘 모르겠네요

- 임시 변수를 질의 함수로 바꾸기
- 변수 인라인하기
- 함수 선언 바꾸기
- 반복문 쪼개기
- 문장 슬라이드하기

리팩터링 단계를 잘게 나누고 커밋으로 만드는 내용

### 1.5 중간 점검: 난무하는 중첩 함수

### 1.6 계산 단계와 포맷팅 단계 분리하기

프로그램의 논리적인 요소를 파악하기 쉽도록 코드의 구조를 보강했으니, 기능 변경을 해보자

- 단계 쪼개기
- 함수 추출하기
- 데이터는 immutable 하게
- 반복문을 파이프라인으로 바꾸기

### 1.7 중간 점검: 두 파일로 분리됨

44줄 짜리 코드가 70줄이 되었지만 장점이 더 많다

- 전체 로직 구성 요소가 뚜렷이 부각된다
- 계산하는 부분과 출력  형식을 다루는 부분이 분리되었다
- 모듈화로 과정을 파악하기 쉬워졌다

> 코드베이스를 작업 시작 전보다 건강하게 만들어 놓고 떠나야 한다

→ 제가 가장 좋아하는 말입니다. 보이 스카웃 규칙을 지키면 코드가 점점 더 좋아지지 않을까요ㅎㅎ

### 1.8 다형성을 활용해 계산 코드 재구성하기

`amountFor()` 함수를 보면 연극 장르에 따라 계산 방식이 점점 늘어난다

- 조건부 로직을 다형성으로 바꾸기

**공연료 계산기 만들기**

- 함수 선언 바꾸기

**함수들을 계산기로 옮기기**

- 함수 옮기기
- 함수를 인라인

**공연료 계산기를 다형성 버전으로 만들기**

- 타입 코드를 서브클래스로 바꾸기
- 생성자를 팩터리 함수로 바꾸기
- 조건부 로직을 다형성으로 바꾸기

### 1.9 상태 점검: 다형성을 활용하여 데이터 생성하기

- 연극 장르별 계산 코드가 묶였다
- 새로운 장르를 추가하려면 서브클래스를 작성하고 `createPerformanceCalculator()` 에만 추가하면 된다

### 1.10 마치며

요약
1. 원본 함수를 중첩 함수 여러개로 나눴다
2. 계산 코드와 출력 코드를 분리했다
3. 계산 로직을 다형성으로 표현했다

> 좋은 코드를 가늠하는 확실한 방법은 ‘얼마나 수정하기 쉬운가’ 다

→ 단계를 잘게 나누고 컴파일 - 테스트가 작동하는 상태로 여러번 커밋해서 작업한다는 것에 몹시 놀랐습니다. commit을 작은 단위로 나눠서 하면 좋다는 말은 많이 들었지만 이렇게 구체적인 예가 있으니 눈이 확 떠진 기분이네요.