# 6.1 최소 노출의 원칙(POLE)

정보 보안 분야에 최소 권한의 원칙 (principle of least privilege, POLP)를 변형해 최소 노출의 원칙 (principle of least exposure, POLE)을 적용해 보자.

POLP는 시스템 구성 요소에는 최소한의 권한을 부여하고 접근도 최소화하며 노출 역시 최소화해야 한다는 설계 원칙으로, 방어적인 아키텍처 설계를 대변한다.

POLP를 기반으로 아키텍처를 설계해 각 구성 요소가 필요한 최소한의 기능으로 연결되면, 한 구성 요소의 손상이나 장애가 나머지 시스템에 미치는 영향이 최소화되므로 시스템 전체 보안이 더 강력해진다는 장점이 있다.

POLP가 시스템 수준의 컴포넌트 설계에 집중한다면 POLE은 조금 더 낮은 수준의 설계에 집중한다.

- 스코프마다 등록된 변수의 노출을 최소화한다.

프로그램의 한 부분에서 사용할 변수를 스코프를 통해 다른 스코프에 노출시킬때 발생할 수 있는 상황

1. 이름 노출
2. 예기치 않은 작동
3. 의도하지 않은 종속성

POLE은 변수/함수 스코프 지정 시 기본적으로 필요한 최소한의 것만 노출하고 나머지 가능한 한 비공개로 유지하도록 제안한다. 모든 것을 전역 스코프에 담기보다 가능한 한 작고 깊게 중첩된 스코프에 변수를 선언하는 식이다.

# 6.2 일반(함수) 스코프에 숨기기

변수나 함수를 숨겨야 하는 상황이 생기면 특이한 이름을 가진 함수를 정의하는 것보다 함수 표현식을 사용하는게 더 나은 해결책이 될 수 있다.

## 6.2.1 함수 표현식 즉시 호출하기

IIFE (immediately invoked function expression) 즉시 실행 함수 표현식, IIFE는 변수나 함수를 숨기는 스코프를 만들고 싶을 때 유용하다.

독립형 IIFE에서는 ()를 필수로 사용해야 한다. 독립형 IIFE에서는 함수를 문이 아닌 표현식으로 구분한다. 다만 일관성을 위해 IIFE의 function을 항상 ()로 묶어야 한다.

### 함수의 경계

스코프를 감싸는 코드에 return, this, break, continue가 포함된 경우라면 아마도 IIFE가 최선의 접근 방식이 아닐 수 있다.

# 6.3 블록으로 스코프 지정

블록 스코프를 지원하는 대부분의 프로그래밍 언어에서 명시적으로 블록 스코프를 만드는 건 변수의 범위를 좁히는 일반적인 패턴입니다. 따라서 POLE에 따라 JS에서도 이런 패턴이 보편화되어야 한다고 생각한ㅁ다. 식별자가 노출될 수 있는 범위를 최소한으로 줄이려면 블록 스코프를 사용해라.

let으로 변수를 선언할 때 블록 상단에 선언할 필요가 없다는 생각이 들면 내부 명시적 블록 스코프를 사용해 변수의 노출 범위를 좁혀라.

코딩을 할 때 기본 마인드셋으로 최소 노출의 원칙을 지키다 보면 POLE의 이점을 가장 잘 누릴 수 있다.

모든 변수를 하나의 스코프에서 선언하면 코드 구조가 혼란스러워지고, 향후 버그 유발 가능성이 커진다.

## 6.3.1 var와 let

함수 전체에 걸쳐 필요한 변수는 그 용도가 분명하도록 선언해야 한다.

최상위 스코프에서 var를 사용하는게 좋다. → 공감되지 않는다…

## 6.3.2 let의 위치

선언이 블록 스코프에 속해 있다면 let을 사용하고, 함수 스코프에 있다면 var를 사용해라.

## 6.3.3 catch와 스코프

ES2019 이전에는 catch 절에서 오류 객체를 사용하려면 catch 뒤에 매개변수를 반드시 추가해야 했는데 ES2019에서는 선택 사항으로 바뀌었다. → 이건 새로 알았다!

catch 블록을 오류 객체 변수 선언 없이 사용하면 catch 블록은 스코프를 형성하지 않고 그냥 블록으로 처리된다.

오류값 자체는 신경 쓰지 않아도 된다면 catch에 오류 객체 변수 선언을 생략해라.

catch에서 오류 객체 변수를 생략하는 패턴은 작은 변화이지만 많이 쓰이는 효율적인 단순화 패턴이다. 이 패턴을 사용하면 스코프를 줄여서 약간의 성능 향상을 꾀할 수 있다.

# 6.4 블록 내 함수 선언

브라우저에서 돌아가는 JS 엔진이 명세서에 반하는 작동을 허용하는 이유?

ES6에서 블록 스코프가 도입되기 전에 미리 이러한 엔진들은 FiB와 관련된 동작을 지원하고 있는데, ES6 이후 명세서를 준수하기 위해 엔진 동작을 변경하려면 기존 웹 사이트에서 돌아가는 JS 코드에 문제가 발생할 수 있기 때문이다.

FiB는 개발자에게 혼동을 불러일으키고 JS 실행 환경마다 작동 방식이 달라지는 위험한 패턴이다.

# 6.5 정리

렉시컬 스코프 규칙의 핵심은 우리가 렉시컬 스코프 규칙에 맞게 코드를 작성하면 프로그램의 변수를 운영 목적과 의미에 맞게 체계화할 수 있다는 점이다.

변수를 정리하는 데 있어서 가장 중요한 것은 변수를 불필요한 범위에 과도하게 노출되지 않도록 하는 것(POLE)이다.
